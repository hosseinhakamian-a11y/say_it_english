# ๐ด Say It English - ุญุงูุธู ูพุฑูฺู (MANA_MEMORY.md)

## ๐ ุชุงุฑุฎ ุขุฎุฑู ุจุฑูุฒุฑุณุงู: ฑน ุจููู ฑดฐด (2026-02-08) - ุณุงุนุช ฑฒ:ดฐ ุชูุฑุงู

---

## ๐ ุขุฎุฑู ูพุดุฑูุชโูุง (ุงู ุฌูุณู)

### 1. ุฑูุน ูุดฺฉู Session Persistence โ
ุณุณุชู ุงุญุฑุงุฒ ููุช ฺฉุงููุงู ุจุงุฒููุณ ุดุฏ:

| ูุงู | ุชุบุฑ |
|------|-------|
| `api/login.ts` | ุชููุฏ session token + ุฐุฎุฑู ุฏุฑ DB + ุณุช ฺฉุฑุฏู ฺฉูฺฉ |
| `api/logout.ts` | ูพุงฺฉ ฺฉุฑุฏู ฺฉูฺฉ + ุญุฐู session ุงุฒ DB |
| `api/register.ts` | ุชููุฏ session + auto-login ุจุนุฏ ุงุฒ ุซุจุชโูุงู |
| `api/user.ts` | ุฎูุงูุฏู session ุงุฒ ฺฉูฺฉ + ุจุงุฒฺฏุฑุฏุงูุฏู ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ |
| `api/index.ts` | ุจูุจูุฏ parse ฺฉูฺฉ ุจุฑุง auth check |

**ูุชุฌู:** ุญุงูุง ฺฉุงุฑุจุฑ ุจุนุฏ ุงุฒ refresh ุตูุญู ูุงฺฏู ูโูุงูุฏ! ๐

### 2. ุจูุจูุฏ ุฑุงุจุท ฺฉุงุฑุจุฑ Navbar โ
- ุงุถุงูู ุดุฏู **Loading skeleton** ุจุฑุง ุฌููฺฏุฑ ุงุฒ flash ุฏฺฉููโูุง
- ุชุฑฺฉุจ ุฏฺฉููโูุง ูุฑูุฏ ู ุซุจุชโูุงู ุฏุฑ **ฺฉ ุจุงฺฉุณ ุดุดูโุง** ุจุง gradient

### 3. ุจุฑฺุณุจ ุณุฑูุณ ูุฏู โ
- ุชุบุฑ ุงุฒ ูุงู ฺฉุงูู (`Bunny`, `ArvanCloud`) ุจู ุญุฑูู ุงุฎุชุตุงุฑ (`B`, `A`)

---

## ๐ ุณุณุชู ุงุญุฑุงุฒ ููุช (Cookie-Based Session)

### Flow ุฌุฏุฏ:
```
Login โ Generate sessionToken โ Save to DB โ Set Cookie โ Return user
Refresh โ Read Cookie โ Query DB by sessionToken โ Return user
Logout โ Clear Cookie โ Remove sessionToken from DB
```

### ฺฉูฺฉ ุชูุธูุงุช:
- **Name:** `session`
- **HttpOnly:** โ (ุงูู)  
- **Secure:** โ (ููุท HTTPS)
- **SameSite:** `Lax`
- **Max-Age:** 7 ุฑูุฒ (30 ุฑูุฒ ุจุง rememberMe)

---

## ๐๏ธ ูุนูุงุฑ Dual-CDN

### ุงุณุชุฑุงุชฺ Multi-CDN ุจุฑุง ูพุฎุด ูุฏู
ุณุณุชู ุงุฒ **ุฏู ููุจุน ููุฒูุงู** ุจุฑุง ูุฑ ูุฏู ูพุดุชุจุงู ูโฺฉูุฏ:

| ููุจุน | ฺฉุงุฑุจุฑุฏ | ุงูููุช |
|------|--------|--------|
| **ุจุงูโูุช (Bunny.net)** | ฺฉุงุฑุจุฑุงู ุฎุงุฑุฌ ุงุฑุงู | ุจูโุงูููู |
| **ุงุจุฑุขุฑูุงู (ArvanCloud)** | ฺฉุงุฑุจุฑุงู ุงุฑุงู + Fallback | ุฏุงุฎู |

### ูุญูู ุนููฺฉุฑุฏ ููุดููุฏ:
1. **ุชุดุฎุต ููฺฉุดู:** ุงุฒ timezone ฺฉุงุฑุจุฑ ุจุฑุง ุชุดุฎุต ุงุฑุงู ุจูุฏู
2. **ุงูููุชโุจูุฏ:** ฺฉุงุฑุจุฑุงู ุงุฑุงู ุงุจุชุฏุง ุงุฒ ุงุจุฑุขุฑูุงู
3. **Fallback ุฎูุฏฺฉุงุฑ:** ุงฺฏุฑ ฺฉ ููุจุน ุฎุทุง ุฏุงุฏุ ุณูฺ ุจู ููุจุน ุฏฺฏุฑ

---

## ๐ Migration ุฏุชุงุจุณ (ุงูุฌุงู ุดุฏู โ)

```sql
-- ุงุฌุฑุง ุดุฏู ุฏุฑ Supabase:
ALTER TABLE content ADD COLUMN IF NOT EXISTS arvan_video_id TEXT;
ALTER TABLE content ADD COLUMN IF NOT EXISTS arvan_video_provider TEXT;
ALTER TABLE users ADD COLUMN IF NOT EXISTS session_token TEXT;
```

---

## ๐ฌ ุณุฑูุณโูุง ูุฏู ูพุดุชุจุงู ุดุฏู

### ุณุฑูุณ ุจูโุงูููู (Primary)
| ุณุฑูุณ | ฺฉุฏ | ุชูุถุญ |
|-------|-----|-------|
| ุจุงูโูุช | `bunny` | ุงุณุชุฑู ุนููุฏ 9:16 |
| ูุชูุจ | `youtube` | ุงูุจุฏ ุงุณุชุงูุฏุงุฑุฏ |
| ุขูพุงุฑุงุช | `aparat` | ุงูุจุฏ ุงุฑุงู |
| ููฺฉ ูุณุชูู | `custom` | URL ูุณุชูู |

### ุณุฑูุณ ุงุจุฑุขุฑูุงู (Secondary/Iran)
| ุณุฑูุณ | ฺฉุฏ | ุชูุถุญ |
|-------|-----|-------|
| ูพูุชูุฑู ูุฏู | `arvan-vod` | ุงุณุชุฑู ุจุง DRM |
| ูุถุง ุงุจุฑ | `arvan-storage` | ูุงู ูุณุชูู S3 |
| ุจุฏูู ุงุจุฑุขุฑูุงู | `none` | ุบุฑูุนุงู |

---

## โ ฺฉุงุฑูุง ุงูุฌุงู ุดุฏู

- [x] ูพุงุฏูโุณุงุฒ ุณุณุชู Dual-CDN (ุจุงู + ุงุจุฑุขุฑูุงู)
- [x] ุชุดุฎุต ุฎูุฏฺฉุงุฑ ููฺฉุดู ฺฉุงุฑุจุฑ
- [x] Fallback ููุดููุฏ ุจู ููุงุจุน
- [x] ูพูู ุงุฏูู ุจุง ุฏู ุจุฎุด ุฌุฏุงฺฏุงูู ุจุฑุง ูุฑ ููุจุน
- [x] ูพูุฑ ุนููุฏ (9:16) ุจุฑุง ูุฏููุง ููุจุงูโูุญูุฑ
- [x] ููุฏ ุชุงูุจูู ุจุฑุง ูุฑ ุฏุฑุณ
- [x] ุณุณุชู ุฐุฎุฑู ูุญุชูุง ฺฉุงูู
- [x] **ุฑูุน ูุดฺฉู Session Persistence**
- [x] **Cookie-based Authentication**
- [x] **Loading state ุฏุฑ Navbar**
- [x] **ุจุงฺฉุณ ุชุฑฺฉุจ ูุฑูุฏ/ุซุจุชโูุงู**

---

## ๐ฏ ฺฉุงุฑูุง ุจุงูโูุงูุฏู

- [ ] **ุชุณุช ุงุจุฑุขุฑูุงู Storage:** ุขูพููุฏ ูุงู ู ุฏุฑุงูุช ููฺฉ Signed
- [ ] **ุชุณุช ุงุจุฑุขุฑูุงู VOD:** ูุนุงูโุณุงุฒ ูพูุชูุฑู ูุฏู (ุงุฎุชุงุฑ)
- [ ] **ุชุณุช ฺฉุงูู Fallback:** ุดุจูโุณุงุฒ ูุทุน ุดุจฺฉู
- [ ] **ุชุงูุจูู ุฎูุฏฺฉุงุฑ:** ุงุณุชุฎุฑุงุฌ ุงุฒ ูุฏู (ูุงุฒ ุจุนุฏ)
- [ ] **ูพุงุฏูโุณุงุฒ ุชู AI Agents**

---

## ๐ง ูุชุบุฑูุง ูุญุท ูุงุฒู

```env
# Supabase/PostgreSQL
DATABASE_URL=postgresql://...

# ArvanCloud Storage (S3)
ARVAN_ENDPOINT=https://s3.ir-thr-at1.arvanstorage.ir
ARVAN_ACCESS_KEY=your_access_key
ARVAN_SECRET_KEY=your_secret_key
ARVAN_BUCKET_NAME=your_bucket_name
```

---

## ๐ก ุฑุงูููุง ุขูพููุฏ ูุฏู (ุจุฑุง ุงุฏูู)

### ฑ. ุขูพููุฏ ุฏุฑ ุจุงูโูุช (ุฎุงุฑุฌ ุงุฑุงู):
1. ุจู ูพูู Bunny Stream ุจุฑูุฏ
2. ูุฏู ุฑุง ุขูพููุฏ ฺฉูุฏ
3. ุงุฒ ุจุฎุด Embed ููฺฉ ุฑุง ฺฉูพ ฺฉูุฏ
4. ุฏุฑ ูพูู ุงุฏููุ ุจุฎุด "ุณุฑูุณ ุจูโุงูููู" ุฑุง ูพุฑ ฺฉูุฏ

### ฒ. ุขูพููุฏ ุฏุฑ ุงุจุฑุขุฑูุงู (ุฏุงุฎู ุงุฑุงู):
1. ุจู ูพูู ุงุจุฑุขุฑูุงู ุจุฑูุฏ
2. **ุจุฑุง VOD:** ุจุฎุด ูพูุชูุฑู ูุฏู > ุขูพููุฏ > ููฺฉ Embed
3. **ุจุฑุง Storage:** ุจุฎุด ูุถุง ุงุจุฑ > ุขูพููุฏ > ููฺฉ ูุณุชูู
4. ุฏุฑ ูพูู ุงุฏููุ ุจุฎุด "ุงุจุฑุขุฑูุงู" ุฑุง ูพุฑ ฺฉูุฏ

---

## ๐ธ ุงุทูุงุนุงุช ูพุฑุฏุงุฎุช
- **ุขุฏุฑุณ ููุช (BEP20):** `0x2ca84105e9e3f3a91f0385acbd497923d743a342`
- **ุชูุงุณ ูพุดุชุจุงู:** ฐนฑฒณฑฐดฒตด / ฐนฒฒฒดตณตทฑ

---
*ุงู ูุงู ูุฑุฌุน ุงุตู Antigravity ุจุฑุง ุงุฏุงูู ฺฉุงุฑ ุฏุฑ ุฌูุณุงุช ุขูุฏู ุงุณุช.*
