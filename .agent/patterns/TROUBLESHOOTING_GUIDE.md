# راهنمای عیب‌یاابی پروژه (Troubleshooting Guide)

این فایل شامل مشکلات رایج و راه حل‌های تجربه شده در پروژه است تا از اتلاف وقت در آینده جلوگیری شود.

## 1. عدم نمایش محتوا یا خطای اتصال دیتابیس (Content Not Loading)

### نشانه‌ها:
- لیست ویدیوها یا دوره‌ها خالی است.
- خطای `Tenant or user not found` یا `ENOTFOUND` در ترمینال.
- اسپینر لودینگ بی‌پایان می‌چرخد.

### علت ریشه‌ای:
پروژه‌های Supabase ممکن است Region خود را تغییر دهند (مثلاً از `eu-central-1` به `eu-north-1`). اگر `DATABASE_URL` در فایل `.env` یا کش سیستم قدیمی باشد، اتصال برقرار نمی‌شود.

### راه حل فوری:
1. اتصال مستقیم را چک کنید (تست با اسکریپت دیاگنوستیک).
2. فایل `.env.local` را با مقدار جدید از پنل Supabase آپدیت کنید.
3. **مهم:** سرور (`npm run dev`) را حتماً ریستارت کنید.

---

## 2. خطای ذخیره پروفایل (Profile Update Error)

### نشانه‌ها:
- دکمه "ذخیره تغییرات" کار نمی‌کند یا خطای 404/500 می‌دهد.
- درخواست در Network Tab قرمز می‌شود.

### علت:
در فایل `api/index.ts`، روت‌های مربوط به `PATCH /api/profile` (برای اطلاعات) یا `POST /api/profile/password` (برای رمز) تعریف نشده‌اند.

### راه حل:
مطمئن شوید هندلر API شامل بلوک‌های شرطی زیر است:
```typescript
if (pathname === '/api/profile' && method === 'PATCH') { ... }
if (pathname === '/api/profile/password' && method === 'POST') { ... }
```

---

## 3. مشکلات ورودی OTP (SMS Verification)

### نشانه‌ها:
- کاربر نمی‌تواند تایپ کند.
- بعد از تایپ، اعداد جابجا می‌شوند یا کادرها خالی می‌مانند.
- خطای اعتبارسنجی "کد باید ۶ رقم باشد" بی‌دلیل ظاهر می‌شود.

### علت:
استفاده از فاصله (`" "`) برای پر کردن خانه‌های خالی (Placeholder) باعث تداخل در `value` اینپوت می‌شود.

### راه حل:
- همیشه از **Local State** (`['', '', ...]`) استفاده کنید.
- مقدار `value` اینپوت را اگر خالی است، `""` (رشته تهی) بگذارید، نه فاصله.
- فایل مرجع: `.agent/patterns/OTP_IMPLEMENTATION_GUIDE.md`

---
**تاریخ بروزرسانی:** 2026-02-12
